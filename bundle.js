(()=>{"use strict";const t=800,e=320,i=.12;var s;!function(t){t.TITLE="TITLE",t.PLAYING="PLAYING",t.WIN="WIN"}(s||(s={}));const h=document.getElementById("gameCanvas"),a=new class{constructor(t){this.gameState=s.TITLE,this.playerX=80,this.playerDirection="right",this.edieX=650,this.treats=[],this.treatsCollected=0,this.keys=new Set,this.animFrame=0,this.playerMoving=!1,this.pettingScale=i,this.gameLoop=()=>{this.update(),this.render(),requestAnimationFrame(this.gameLoop)},this.canvas=t,this.ctx=t.getContext("2d")}async init(){const[t,e,h]=await Promise.all([this.loadImage("sprites/megan_walking.png"),this.loadImage("sprites/edie.png"),this.loadImage("sprites/megan_petting_edie.png")]);this.meganSprite=this.trimTransparent(this.removeBackground(t)),this.edieSprite=this.trimTransparent(this.removeBackground(e)),this.pettingSprite=this.trimTransparent(this.removeBackground(h)),this.pettingScale=this.meganSprite.height/this.pettingSprite.height*i;for(let t=0;t<4;t++)this.treats.push({x:180+120*t,y:305,collected:!1});window.addEventListener("keydown",t=>{this.keys.add(t.key),"Enter"===t.key&&this.gameState===s.TITLE&&(this.gameState=s.PLAYING)}),window.addEventListener("keyup",t=>{this.keys.delete(t.key)}),this.gameLoop()}loadImage(t){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.src=t})}removeBackground(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0);const s=i.getImageData(0,0,e.width,e.height),h=s.data,a=h[0],r=h[1],n=h[2];for(let t=0;t<h.length;t+=4){const e=h[t],i=h[t+1],s=h[t+2];Math.abs(e-a)<=30&&Math.abs(i-r)<=30&&Math.abs(s-n)<=30&&(h[t+3]=0)}return i.putImageData(s,0,0),e}trimTransparent(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height),{data:i,width:s,height:h}=e;let a=s,r=h,n=0,c=0;for(let t=0;t<h;t++)for(let e=0;e<s;e++)i[4*(t*s+e)+3]>0&&(e<a&&(a=e),e>n&&(n=e),t<r&&(r=t),t>c&&(c=t));if(n<a||c<r)return t;const l=n-a+1,o=c-r+1,d=document.createElement("canvas");return d.width=l,d.height=o,d.getContext("2d").drawImage(t,a,r,l,o,0,0,l,o),d}update(){if(this.animFrame++,this.playerMoving=!1,this.gameState!==s.PLAYING)return;(this.keys.has("ArrowLeft")||this.keys.has("a")||this.keys.has("A"))&&(this.playerX-=3,this.playerDirection="left",this.playerMoving=!0),(this.keys.has("ArrowRight")||this.keys.has("d")||this.keys.has("D"))&&(this.playerX+=3,this.playerDirection="right",this.playerMoving=!0);const e=this.meganSprite.width*i/2;this.playerX=Math.max(e,Math.min(t-e,this.playerX));for(const t of this.treats)!t.collected&&Math.abs(this.playerX-t.x)<30&&(t.collected=!0,this.treatsCollected++);Math.abs(this.playerX-this.edieX)<50&&(this.gameState=s.WIN)}render(){switch(this.ctx.clearRect(0,0,t,400),this.gameState){case s.TITLE:this.renderTitle();break;case s.PLAYING:this.renderPlaying();break;case s.WIN:this.renderWin()}}drawBackground(){this.ctx.fillStyle="#87CEEB",this.ctx.fillRect(0,0,t,e),this.drawClouds(),this.ctx.fillStyle="#4CAF50",this.ctx.fillRect(0,e,t,80)}drawClouds(){this.ctx.fillStyle="rgba(255, 255, 255, 0.85)";const t=[{x:100,y:60},{x:350,y:90},{x:600,y:50},{x:750,y:100}];for(const e of t)this.ctx.beginPath(),this.ctx.arc(e.x,e.y,25,0,2*Math.PI),this.ctx.arc(e.x+30,e.y-10,30,0,2*Math.PI),this.ctx.arc(e.x+60,e.y,25,0,2*Math.PI),this.ctx.arc(e.x+30,e.y+5,20,0,2*Math.PI),this.ctx.fill()}drawSprite(t,e,i,s=!1,h=.12){const a=t.width*h,r=t.height*h;this.ctx.save(),s?(this.ctx.translate(e,i-r),this.ctx.scale(-1,1),this.ctx.drawImage(t,-a/2,0,a,r)):this.ctx.drawImage(t,e-a/2,i-r,a,r),this.ctx.restore()}drawTreat(t,e){this.ctx.fillStyle="#D2B48C",this.ctx.beginPath(),this.ctx.arc(t-8,e,5,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(t+8,e,5,0,2*Math.PI),this.ctx.fill(),this.ctx.fillRect(t-8,e-3,16,6)}drawEdieAnimated(t,e){const s=this.edieSprite,h=s.width*i,a=s.height*i,r=Math.floor(.65*s.height)+2,n=r*i;this.ctx.drawImage(s,0,0,s.width,r,t-h/2,e-a,h,n);const c=Math.floor(.65*s.height)-2,l=s.height-c,o=l*i,d=t,g=e-a+Math.floor(.65*s.height)*i,x=.18*Math.sin(.18*this.animFrame);this.ctx.save(),this.ctx.translate(d,g),this.ctx.rotate(x),this.ctx.drawImage(s,0,c,s.width,l,-h/2,-.24,h,o),this.ctx.restore()}drawMeganAnimated(t,e,s){const h=this.meganSprite,a=h.width*i,r=h.height*i;if(!this.playerMoving)return void this.drawSprite(h,t,e,s);const n=Math.floor(.2*h.height)+2,c=n*i,l=Math.floor(.2*h.height)-2,o=h.height-l,d=o*i,g=1.5*Math.sin(.3*this.animFrame);this.ctx.save(),s?(this.ctx.translate(t,e-r),this.ctx.scale(-1,1),this.ctx.drawImage(h,0,0,h.width,n,-a/2,g,a,c),this.ctx.drawImage(h,0,l,h.width,o,-a/2,Math.floor(.2*h.height)*i-.24,a,d)):(this.ctx.drawImage(h,0,0,h.width,n,t-a/2,e-r+g,a,c),this.ctx.drawImage(h,0,l,h.width,o,t-a/2,e-r+Math.floor(.2*h.height)*i-.24,a,d)),this.ctx.restore()}renderTitle(){this.drawBackground(),this.ctx.fillStyle="#333",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText("Edie Quest",400,160),this.ctx.font="20px Arial",this.ctx.fillStyle="#555",this.ctx.fillText("Press Enter to Start",400,210)}renderPlaying(){this.drawBackground();for(const t of this.treats)t.collected||this.drawTreat(t.x,t.y);this.drawEdieAnimated(this.edieX,e),this.drawMeganAnimated(this.playerX,e,"left"===this.playerDirection),this.ctx.fillStyle="#333",this.ctx.font="16px Arial",this.ctx.textAlign="left",this.ctx.fillText(`Treats: ${this.treatsCollected}/4`,10,25)}renderWin(){this.drawBackground(),this.drawSprite(this.pettingSprite,this.edieX-20,e,!1,this.pettingScale),this.ctx.fillStyle="#333",this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText("You Win!",400,100),this.ctx.font="20px Arial",this.ctx.fillStyle="#555",this.ctx.fillText(`Treats collected: ${this.treatsCollected}/4`,400,140)}}(h);a.init()})();